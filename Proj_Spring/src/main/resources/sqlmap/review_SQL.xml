<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="review">

	<select id="getTblReviewNum" resultType="hashMap">
		 <![CDATA[
		 select max(tblReviewNum) from reviewTbl where prodNum = #{prodNum}
		 ]]>
	</select>


	<insert id="post" parameterType="pack.spring.domain.review.ReviewBoardBean">
		<![CDATA[
		insert into reviewTbl (tblReviewNum, prodNum, regId, regName, subject, content, regDate, ip, love, oriFileName, sysFileName, fileSize )
		values
		(#{tblReviewNum}, #{prodNum}, #{regId}, #{regName}, #{subject}, #{content}, now(), #{ip}, 0, #{oriFileName}, #{sysFileName}, #{fileSize})
		]]>
	</insert>
	
	<select id="countBoard" parameterType="hashMap" resultType="Integer">

		select count(*) from reviewTbl where prodNum = #{prodNum}
			<choose>
				<when test="keyField == 'subject'.toString()">
					and subject like concat('%',#{keyWord},'%' )
				</when>
				<when test="keyField == 'uName'.toString()">
					and uName like concat('%',#{keyWord},'%' )
				</when>
				<when test="keyField == 'content'.toString()">
					and subject like concat('%',#{keyWord},'%' )
				</when>
				<otherwise>
					
				</otherwise>
			</choose>
	</select>
	
	<select id="list" parameterType="hashMap" resultType="hashMap">
		select * from reviewTbl where prodNum = #{prodNum}
			<choose>
				<when test="keyField == 'subject'.toString()">
					and subject like concat('%',#{keyWord},'%' )
				</when>
				<when test="keyField == 'uName'.toString()">
					and uName like concat('%',#{keyWord},'%' )
				</when>
				<when test="keyField == 'content'.toString()">
					and subject like concat('%',#{keyWord},'%' )
				</when>
				<otherwise>
					
				</otherwise>
			</choose>
			order by tblReviewNum limit #{pageStart}, #{perPageNum}
	</select>

</mapper>